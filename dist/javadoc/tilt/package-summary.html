<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Mon Jul 28 20:57:53 EST 2014 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>tilt (TILT)</title>
<meta name="date" content="2014-07-28">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="tilt (TILT)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../calliope/package-summary.html">Prev Package</a></li>
<li><a href="../tilt/align/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?tilt/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;tilt</h1>
<div class="docSummary">
<div class="block">TILT &ndash; text-to-image linking tool</div>
</div>
<p>See:&nbsp;<a href="#package_description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../tilt/JettyServer.html" title="class in tilt">JettyServer</a></td>
<td class="colLast">
<div class="block">This launches the Jetty service</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../tilt/JettyServerThread.html" title="class in tilt">JettyServerThread</a></td>
<td class="colLast">
<div class="block">This launches an instance of the Jetty service</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../tilt/Utils.html" title="class in tilt">Utils</a></td>
<td class="colLast">
<div class="block">Some routines that need sharing by all</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package_description">
<!--   -->
</a>
<h2 title="Package tilt Description">Package tilt Description</h2>
<div class="block"><h3>TILT &ndash; text-to-image linking tool</h3>
 <p>The TILT service is designed to automate the process of recognising
 word-shapes on images. TILT doesn't attempt to do optical character
 recognition (OCR) on those words because in manuscripts this is too
 difficult and the word-shapes vary too much between hands etc. Instead
 it tries just to recognise the shapes or outlines of words, and to link
 them with words in a supplied transcription. In this way the reader of a
 text+image can pass the mouse over or tap on a text word by word and see
 the area of an image corresponding to a word or vice versa.</p>
 <h4>First stage &ndash; reduce an image to plain black and white</h4>
 <p>In order to do this TILT first reduces the image, assumed to be in
 colour, to 256 shade greyscale. The <a href="../tilt/image/Picture.html#convertToGreyscale()"><code>convertToGreyscale</code></a> method
 performs this service. Next the image is reduced to pure black and white
 by passing over it a local contrast filter. Simply converting to black
 and white in the same way as converting it to greyscale would not work
 if the lighting is uneven. The method employed in <a href="../tilt/image/Picture.html#convertToTwoTone()"><code>convertToTwoTone</code></a> is borrowed from
 the <a href="https://code.google.com/p/ocropus/"> ocropus
 toolset</a>.</p>
 <p>Removal of noise involves the identification of borders. For this the
 <a href="../tilt/image/Border.html" title="class in tilt.image"><code>Border</code></a> class examines the edges of the image, looking
 for dark areas or 'blobs' (<a href="../tilt/image/Blob.html" title="class in tilt.image"><code>Blob</code></a>) on the extreme
 margins, which are extended inwards by following any blobs discovered
 there. Then a broader area further in from this narrow border is
 examined for large blobs with a high aspect-ratio (horizontal or
 vertical). These are also added to the border. Finally, the blobs
 identified in this way are removed.</p>
 <h4>Second Stage &ndash; Recognise lines</h4>
 <p>In order to recognise words their approximate location and their
 sequence on the page must be worked out. For this TILT currently assumes
 a top to bottom and left to right text-orientation. Other orientations
 could, however, be supplied as options later on. Since text in
 manuscripts may be deliberately warped, and line spacing may be very
 uneven, and may include deletions and insertions, traditional OCR
 methods, which rely on a basically even distribution of lines on the
 page won't work. TILT thus divides the page into a number of rectangular
 regions, about 200 of these down for a 1200 pixel image and just 25
 blocks across. The reason for this is that text lines basically have
 this shape. The black pixels in each rectangle are then added up, and if
 they exceed the mean, they are considered to be part of a line. Lines
 are identified by examining the columns of rectangles, and assuming that
 a peak value is at the centre of a line. This is the purpose of the
 <a href="../tilt/image/FindLines.html" title="class in tilt.image"><code>FindLines</code></a> class.</p>
 <p>But this only identifies line fragments in vertical columns and does
 not arrange them into lines. The purpose of the <code>tilt.image.matchup</code> package is to align adjacent line-fragments and
 assemble them into lines. The aligned line-fragments are then assembled
 into an entire page of lines by the <code>tilt.image.page</code> package.</p>
 <h4>Third Stage &ndash; Recognise Words</h4>
 <p>The lines have been recognised. By following them, and
 examining a small region on each side, blobs of adjacent black pixels that
 represent words and parts of words can be identified.</p>
 <p>Each blob is then surrounded by a polygon, using the <code>FastConvexHull</code> algorithm. This assesses the
 outermost pixels of each blob and produces a minimal set belonging to a 
 convex polygon. The distance between adjacent polygons is then
 calculated. The <a href="../tilt/Utils.html#distanceBetween(java.awt.Polygon, java.awt.Polygon)"><code>Utils.distanceBetween(java.awt.Polygon, java.awt.Polygon)</code></a> method is used to 
 compute the gaps between polygons.
 These are then sorted by decreasing size. Next the number of words in
 the text to be aligned <em>with</em> these blobs is used to determine
 what is the smallest inter-polygon gap that designates a word-gap. So a gap 
 chosen for, say, 250 words, ensures that approximately 249 gaps will be 
 designated as inter-word gaps. All other gaps on the same line are
 eliminated by merging bobs on either side. <a href="../tilt/Utils.html#mergePolygons(java.awt.Polygon, java.awt.Polygon)"><code>Utils.mergePolygons(java.awt.Polygon, java.awt.Polygon)</code></a> performs
 this task.</p> <p>Finally, having determined the word-shapes, those
 shared by more than one line are moved to the closest line, 
 using the <a href="../tilt/image/page/Line.html#merge(java.util.HashMap)"><code>Line.merge(java.util.HashMap&lt;java.awt.Polygon, tilt.image.page.Line&gt;)</code></a> method.</p>
 <h4>Fourth Stage &ndash;Linking shapes to text</h4>
 <p>To link shapes with the text can be achieved automatically by
 converting the actual words of the known transcription to pixel widths,
 and then comparing them to the actual pixel-widths of those words in the
 page image. Since the number of words and chaaracters in the text are
 known, it is simple to average out the pixel-widths of each letter and
 so estimate the widths of each word in the text. Then, by adapting a
 text-alignment algorithm (Ukkonen's famous diagonal diff algorithm from
 Information and Control 1985), the pixel-widths in the page image can be
 optimally aligned with those represented by the text. This gives us the
 desired word-text alignment at the word level. However, since many
 shapes may align with one word, or vice versa, many words may be found
 in one shape, simply aligning shapes to words won't work in practice. To
 overcome this Ukkonen's algorithm was extended to allow not only
 insertions, deletions and exchanges, but also h-extensions and
 v-extensions, whereby <em>several</em> words or several shapes can align
 with <em>one</em> of the other kind. When this happens shapes are merged
 or split as required.</p>
 <p>Shapes can also be aligned with words that split over a line. This happens
 either when there is a misalignment, or legitimately if a merged word 
 (hyphen removed) is aligned with two halves at line-end and line start in 
 a page image. In this case the word in the source text ill be split at a 
 nice hyphenation point, and each half aligned with the correct polygon.</p>
 <h4>API</h4>
 <p>TILT is designed as a REST service with some simple GET and POST methods. 
 The primary TILT service is the context /tilt/. The GET and POST requests 
 are handled as follows:</p>
 <ul><li>GET<ol> <li>test &ndash; this sub-service gets combined with the
 following path-component to form the name of a class that should be a
 sub-class of tilt.test.Test. So the path /tilt/test/post will invoke the
 tilt.test.Post handle method when a GET request is directed to
 that URL.</li> <li>image &ndash; this will be directed to the <a href="../tilt/handler/TiltImageHandler.html" title="class in tilt.handler"><code>TiltImageHandler</code></a> class. Required parameters are:
 <ul><li>docid: the URL of a suitable image file</li> <li>pictype: this
 <em>must</em> be one of the values in the <a href="../tilt/constants/ImageType.html" title="enum in tilt.constants"><code>ImageType</code></a> enumeration (currently original, greyscale,
 twotone, cleaned, baselines, words, link). Asking for any one of these
 will cause the required image-types to be generated. The last one
 generates the text-to-image links and so calls all the others. The
 service will then return an image of the appropriate type. Hence this
 method is usually not called directly. It is rather used in HTML via a
 statement like &lt;img
 src="http://ecdosis.net/tilt/?docid=http:%2F%2Fecdosis.net%2Fimages%2F%2F00000005.jpg&amp;pictype=original"
 width="500"&gt;, which will generate a GET request for that
 image.</li></ul> <li>geojson &ndash; this will call the GeoJsonHandler
 class and return a GeoJson document containing all the text to image 
 alignments at the word-level. A POST of the image and its text must have 
 been done first or a TiltException will be raised.</li></ol> 
 <li>POST<br>Posting a basic GeoJson document to
 /tilt/ will load that image, making it available for later linking (via
 GET). This method will return a HTML &lt;img&gt; element containing a
 suitable image as confirmation. This can be embedded in the source
 document or ignored. Parameters for POST are:<ul> <li>geojson: the
 GeoJson document (required). The GeoJson document should contain a basic
 page description, including coordinates expressed as percentages of the
 image area, e.g.:<br> <code>{<br>&nbsp;&nbsp;"type":
 "Feature",<br>&nbsp;&nbsp;"geometry":
 {<br>&nbsp;&nbsp;&nbsp;&nbsp;"type": "Polygon",<br>
 &nbsp;&nbsp;&nbsp;&nbsp;"coordinates": [<br>&nbsp;&nbsp;&nbsp;&nbsp;[
 [0.0, 0.0], [100.0, 0.0], [100.0, 100.0], [0.0, 100.0]
 ]<br>&nbsp;&nbsp;&nbsp;&nbsp;]<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;"properties":
 {<br>&nbsp;&nbsp;&nbsp;&nbsp;"url":
 "http://ecdosis.net/images/00000013.jpg"<br>&nbsp;&nbsp;}<br>}</code>.<br>
 The "url" property is required. In future a full description of the page 
 will be possible, specifying shapes whose alignment with the text should 
 be fixed.</li> <li>encoding: the GeoJson document's encoding (optional)</li> 
 <li>pictype: the desired pictype for the returned image (optional)</li> 
 <li>text: the text to align to. This should be in HTML (required).</li> </ul>
 </li></ul>
 <h4>GeoJson response</h4>
 <p><code>{"bbox":<br>
 &nbsp;&nbsp;[0.0,0.0,100.0,100.0],<br>
 &nbsp;&nbsp;"features":<br>
 &nbsp;&nbsp;[<br>
 &nbsp;&nbsp;&nbsp;&nbsp;{<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type":"FeatureCollection",<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"bbox":[445,65,472,81],<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name":"Line",<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"features":<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type":"Feature",<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"geometry":<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type":"Polygon",<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"coordinates":<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0.005,4.9736246E-4],<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0.0051123598,4.8982666E-4],<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0.005247191,4.8982666E-4],<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"properties":<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"offset":21,<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"hyphen:5<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
 &nbsp;&nbsp;&nbsp;&nbsp;},<br>
 &nbsp;&nbsp;&nbsp;&nbsp;....<br>
 &nbsp;&nbsp;]<br>
 }</code></p>
 <h4>TILT Service</h4>
 <p>TILT runs as a HTTP service on port 8082. The default URL is: 
 http://localhost:8082/tilt, but this can be simplified to 
 http://localhost/tilt/ by using mod-proxy. TILT uses Jetty to produce a 
 standalone service, but it can be easily converted to run in an application-
 server like Tomcat. TILT can be started via the tilt-start.sh script and 
 similarly stopped via tilt-stop.sh. These scripts set up the required jars 
 and also the path to the aesespeller library.</p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../calliope/package-summary.html">Prev Package</a></li>
<li><a href="../tilt/align/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?tilt/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
